# Changelog

## 1.0.0
- One-click system rollback with full system restore and automatic backup creation.
- Rollback preview showing package changes (added, removed, upgraded, downgraded), kernel version comparison, and affected subvolumes.
- Snapshot integrity verification with btrfs subvolume checks via D-Bus method.
- Multi-subvolume support for root (/), /home, /var, and other subvolumes with atomic operations.
- Preferences dialog to select which subvolumes to snapshot with automatic subvolume detection.
- Snapshot exclusion patterns to reduce snapshot sizes by omitting unnecessary files (caches, temporary files, build artifacts).
- Exclusion pattern types: Prefix (paths starting with pattern), Suffix (paths ending with pattern), Glob (wildcard matching), and Exact (exact path match).
- System default exclusions for common temporary and cache directories with user-customizable patterns via Preferences → Exclusions tab.
- Exclusion configuration via SaveExcludeConfig D-Bus method stored at /etc/waypoint/exclude.toml requiring configure-system authorization.
- Package tracking with automatic capture of installed package list and integration with XBPS package manager.
- Package diff viewer with side-by-side snapshot selection and version change tracking.
- Browse snapshots feature to open snapshot directories in file manager via xdg-open.
- Real-time snapshot search and filter with text search and date range filters (7/30/90 days, or all).
- Match count display showing filtered vs total snapshots with instant UI updates.
- Command-line interface (waypoint-cli) for scriptable snapshot management with comprehensive features.
- CLI support for all snapshot operations: create, list, show, delete, restore, verify, compare, and cleanup with dry-run mode.
- CLI backup management: backup, list-backups, verify-backup, restore-backup, scan-destinations, and drive-stats commands.
- CLI file restoration with restore-files command supporting individual file/directory recovery with custom target paths and overwrite options.
- CLI quota management: enable/disable quotas (simple or traditional qgroups), status checking, and limit configuration with human-readable sizes.
- CLI JSON output mode for all commands enabling machine-readable results for scripting and monitoring integration.
- CLI command aliases for convenience: ls (list), info (show), del/rm (delete), rollback (restore), compare (diff).
- Scheduled snapshots with runit service (waypoint-scheduler) for automated periodic creation.
- GUI configuration dialog for scheduler with service status monitoring and live service restart.
- Scheduler quick presets: "Daily at 2 AM", "Daily at Midnight", and "Weekly on Sunday".
- Live schedule preview showing next snapshot time in human-friendly format.
- Retention policies with visual GUI for configuring automatic snapshot cleanup.
- Configurable max snapshots, max age, minimum count, and keep patterns for pinned snapshots.
- Real-time preview of snapshots to be deleted by retention policy.
- Snapshot analytics dialog with overview statistics, space usage trends, growth analysis, actionable insights and recommendations, and visual size comparison of largest snapshots.
- Automatic backup system with mount detection for external drives and network shares.
- Backup destination configuration UI with support for local paths and remote SSH locations.
- Automatic destination discovery with real-time mount point monitoring for USB drives and network shares.
- Pending backup queue with automatic retry mechanism for failed backups when destinations become available.
- Backup size tracking with accurate disk usage calculation for all backup operations.
- Desktop notifications for backup completion with success/failure status and detailed summaries.
- Streamlined startup experience with removal of unnecessary authentication prompts for read-only operations.
- GTK4 + libadwaita modern interface following GNOME HIG with header bar and boxed-list styling.
- Hamburger menu with theme switcher (system/light/dark mode, 32x32 circular buttons).
- Custom Waypoint icons in multiple sizes (128x128, 256x256, 512x512, SVG).
- 16x16 waypoint icon prefix on each snapshot row for visual branding.
- Real-time disk space monitoring in footer with color-coded warnings (green/yellow/red).
- Auto-refresh UI every 30 seconds to show external snapshots from scheduler/CLI.
- Toast notifications providing centralized in-app feedback for all operations.
- Desktop notifications for snapshot creation, deletion, restoration, and retention cleanup.
- Scheduler notifications with background D-Bus signal listener for automated snapshot creation alerts.
- D-Bus signal system with waypoint-helper emitting SnapshotCreated signals.
- GUI listens for signals via background thread with tokio runtime and thread-safe channels.
- Default window size optimized to 800x720 for better content visibility.
- Reduced margin between date filters and snapshot list (24px → 12px).
- Optimized Snapshot Preferences dialog height (450px) for comfortable viewing.
- Centralized configuration system with environment variable support for all paths and settings.
- Setup script preserving configuration on upgrades without overwriting existing configs.
- Privilege-separated architecture with D-Bus system service and Polkit integration.
- Input validation preventing command injection and invalid snapshot names.
- Path validation preventing directory traversal attacks in file browser.
- Automatic fstab backup before system modifications to prevent data loss.
- Polkit automation allowing root to bypass authentication for automated operations.
- Disk space warnings requiring minimum 1GB free space before snapshot creation.
- Filesystem query caching with TTL-based cache for expensive operations (5-minute snapshot size, 30-second disk space).
- Memory optimization using Rc<T> for large data structures.
- UI threading with all blocking operations moved to background threads.
- Informative error dialogs with helpful troubleshooting steps instead of ungraceful exits.
- Modular Rust codebase with separate modules for btrfs, snapshot, UI, signal_listener, and notifications.
- Professional namespace (tech.geektoshi.waypoint) for all D-Bus services and desktop entries.
- JSON-based metadata persistence at /var/lib/waypoint/snapshots.json with automatic phantom cleanup.
- Zero compilation warnings with clean, maintainable code and consistent style.
- Comprehensive setup.sh installation script with automatic dependency checking.
- Desktop entry file, Polkit policy files, and D-Bus service configuration.
- MIT license with comprehensive README and documentation.
- Per-user snapshot notes with rich multi-line text editor and live character counter.
- Note editor dialog with snapshot context (name, timestamp), placeholder text, and keyboard shortcuts (Ctrl+Enter to save, Escape to cancel).
- Pin favorite snapshots to keep them at the top with visual starred/non-starred icons.
- Pinned snapshots appear in dedicated "Pinned Restore Points" section above regular snapshots.
- Lazy-loading preferences dialog - Scheduling tab only requests authentication when actually viewed.
- User preference architecture with separated per-user data (favorites, notes) from system-wide snapshot metadata.
- Notes and favorites stored per-user at ~/.local/share/waypoint/user-preferences.json allowing multiple users different preferences.
- World-readable shared snapshot metadata at /var/lib/waypoint/snapshots.json accessible to all users.
- Enhanced note display in snapshot list with 60-character truncation and clean "Note:" prefix.
- Timeline-based retention policies with configurable hourly, daily, weekly, monthly, and yearly buckets.
- Non-btrfs external drive backup support via rsync for NTFS, exFAT, and network shares.
- Incremental backups to Btrfs drives using btrfs send/receive with parent snapshot tracking for efficient space usage.
- Backup filter system with multiple modes: All (backup everything), Favorites (pinned snapshots only), Last 7/30 days (recent snapshots), and Critical (system-only snapshots excluding user data).
- Flexible backup triggers: automatic backup on snapshot creation, automatic backup on drive mount, and manual backup initiation.
- Backup queue management with chronological processing (oldest first) to maintain proper parent relationships for incremental backups.
- Per-destination backup retention policies with age-based automatic cleanup (delete backups older than X days).
- Real-time backup progress tracking with BackupProgress D-Bus signals showing bytes transferred, total bytes, transfer speed, and current stage (preparing, transferring, verifying, complete).
- Backup status footer in main window showing healthy/pending/failed/disconnected states with clickable link to backup preferences.
- Failed backup tracking with detailed error messages and manual retry functionality for all failed backups.
- Individual backup deletion from external drives with D-Bus DeleteBackup method requiring create-snapshot authorization.
- Backup retention application via D-Bus ApplyBackupRetention method with configurable age threshold and filter matching.
- Drive statistics with total/used/available space, backup count, last backup timestamp, and filesystem type detection.
- Backup verification with file count and size comparison between source and destination.
- Automatic integrity verification for restored snapshots with file count comparison, size validation (5% tolerance), subvolume validation for btrfs restores, and read access verification.
- BackupManager component orchestrating automatic backups with configuration management, queue handling, live progress monitoring, and status tracking.
- UpdateSnapshotMetadata D-Bus method for updating snapshot metadata (size_bytes and other computed fields) requiring configure-system authorization.
- Audit logging for security-critical operations (snapshot creation, deletion, restore, configuration changes, backup operations).
- Rate limiting for expensive operations (5-second cooldown per user/operation) to prevent DoS attacks.
- Configurable Polkit authentication timeout via WAYPOINT_POLKIT_TIMEOUT environment variable (default: 120 seconds).
- Input validation for octal escape sequences in btrfs paths preventing control character injection.
- Path validation enforcing UTF-8 compliance for all filesystem operations.
- Integer overflow protection using checked arithmetic for quota calculations.
- Backup destination validation restricting writes to approved removable drives and network shares only.
- Restore destination validation preventing arbitrary filesystem writes outside snapshot directory.
- Multi-subvolume file restore with automatic subvolume detection from snapshot metadata.
- Symlink attack prevention with comprehensive target validation and boundary checks including explicit symlink detection in exclusion deletion.
- TOCTOU mitigation with inode verification capturing inode number and device ID after canonicalization and re-verifying before filesystem operations.
- Mutex poisoning detection with global counter tracking poisoning events and critical alerts after 10 occurrences.
- Resource cleanup verification in error paths with automatic cleanup of failed snapshot creations, restore operations, and orphaned snapshots with comprehensive logging.
- Error message sanitization removing sensitive paths before displaying to users.
- Defensive bounds checking for /proc filesystem parsing.
- Progress channel backpressure monitoring with warning logs for slow consumers.
- Keyboard shortcuts window accessible via hamburger menu and Ctrl+? showing all available shortcuts with visual key buttons.
- Scheduler service status indicator with color-coded circles (green for running, red for stopped, gray for disabled).
- Sparkline visualization in snapshot schedules showing actual snapshot creation history instead of expected time slots.
- Backup preferences UI simplified by removing redundant header section and manual scan button (auto-scans every 5 seconds).
- Backup pending queue UI cleaned up to remove duplicate "No pending backups" empty state message.
- Automatic cleanup of orphaned writable snapshot copies after restore operations preventing disk space waste from accumulated temporary subvolumes.
- CleanupWritableSnapshots D-Bus method for removing orphaned root-writable subvolumes created during multi-subvolume restores with safety checks preventing deletion of currently booted or default subvolumes.
- CLI cleanup-writable-snapshots command for manual cleanup of orphaned writable snapshot copies with detailed output showing deleted paths.
- Comprehensive fstab validation during multi-subvolume restores checking syntax (4-6 fields per entry), mount options (required subvol for btrfs, rw for root), and snapshot subvolume existence preventing boot failures from malformed configuration.
- Multi-subvolume restore validation failing early when /etc/fstab is missing with clear error messages explaining requirements and suggesting alternatives (create new snapshot or restore only root subvolume).
- Writable snapshot cleanup audit logging with detailed tracking of deleted subvolumes and automatic cleanup invocation after successful restore operations.
- Documentation reorganized with technical docs moved to docs/ folder (API.md, ARCHITECTURE.md, FEATURES.md, PERFORMANCE_TESTING.md, SECURITY.md, CLI.md, USER_GUIDE.md, TESTING.md, TROUBLESHOOTING.md).
- README.md features section condensed to concise summary with link to full FEATURES.md for better first-time user experience.
- API.md updated with SaveExcludeConfig, UpdateSnapshotMetadata, DeleteBackup, and ApplyBackupRetention D-Bus methods with authorization requirements.
- ARCHITECTURE.md enhanced with BackupManager component documentation, backup configuration paths, and exclusion patterns system description.
- FEATURES.md expanded with exclusion patterns, backup filters, backup triggers, backup retention, backup status monitoring, and comprehensive CLI feature list.
- PERFORMANCE_TESTING.md updated with parallel computation details, analytics performance notes, backup progress tracking, bulk query optimization, and rate limiting documentation.
- SECURITY.md enhanced with backup operations logging, configuration changes auditing, and comprehensive coverage of all security features.
- TESTING.md updated with accurate test counts (41 tests in waypoint-common) and actual test function names for all modules.
- TROUBLESHOOTING.md expanded with backup status footer issues, pending backup queue problems, exclusion pattern troubleshooting, D-Bus service issues, and rate limiting guidance.
- USER_GUIDE.md enhanced with exclusion patterns usage guide, backup filter configuration, backup triggers setup, pending backup management, failed backup handling, and backup deletion instructions.
- CLI.md providing complete reference for waypoint-cli with all commands, options, examples, and usage patterns.
- Automated security scanning in CI/CD with cargo-audit for dependency vulnerabilities, cargo-deny for license and supply chain validation, security-focused clippy lints, and weekly scheduled runs.
- Multi-threaded scheduler architecture with one thread per enabled schedule allowing concurrent execution of hourly, daily, weekly, and monthly snapshots without blocking.
- Mutex-based snapshot creation serialization preventing race conditions when multiple schedules trigger simultaneously.
- Automatic backup integration for scheduler-created snapshots with D-Bus signal listener triggering backups when "backup on snapshot creation" is enabled.
- Backup queue processing for scheduler snapshots automatically queueing and processing backups when destinations are mounted and available.
- Desktop-friendly Polkit policy (51-waypoint-desktop.rules) for wheel group users providing passwordless snapshot creation and system configuration, cached snapshot deletion (~5 min), and always-ask restore operations.
- Automated service Polkit policy (50-waypoint-automated.rules) enabling passwordless operations for root user and scheduler service.
- Read-only D-Bus operations (list_snapshots, scan_backup_destinations, get_quota_usage, verify_snapshot) no longer require authentication improving UX and fixing quota preferences dialog permission prompt.
- Root filesystem (/) enforcement in snapshot schedules with checkbox always enabled and greyed out ensuring complete system restore capability.
- Safety validation in schedule editor automatically including root filesystem even if unchecked matching manual snapshot behavior.
- Default schedule configurations including root filesystem by default for all schedule types (hourly, daily, weekly, monthly).
- File comparison rewritten to use `find` command with metadata comparison instead of `btrfs send/receive` for improved reliability and compatibility across btrfs-progs versions.
- CompareSnapshots D-Bus method changed to read-only operation (no authentication required) improving UX and performance.
- File comparison UI enhanced with directory-grouped view showing changes organized by top-level directory with smart multi-level detection for paths like /usr/lib and /home/user.
- File comparison results sorted by change count (largest directories first) with expandable groups showing up to 5 files per directory and overflow count.
- Comparison summary dialog now displays actual file change count instead of "Not available" with real-time background calculation.
- GetQuotaUsage D-Bus method changed to read-only operation (no authentication required) consistent with other read-only operations.
